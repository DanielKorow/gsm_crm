{% extends 'manager/base.html' %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
			<!-- MAIN CONTENT -->
			<div class="main-content">
				<div class="container-fluid">
					<!-- OVERVIEW -->
					<div class="panel panel-headline">
						<div class="panel-heading">
							<h3 class="panel-title">Создать заказ</h3>
							<p class="panel-subtitle">Заполните все поля ниже и нажмите кнопку "Добавить", что бы добавить позицию к заказу</p>
						</div>
						<div class="panel-body">
							<div class="row">
								<div class="col-md-1">
									<b>Позиция: </b>
								</div>
<!-- 								<div class="col-md-1">
									<b>Размер: </b>
								</div> -->
								<div class="col-md-2">
									<b>Метод нанесения: </b>
								</div>
								<div class="col-md-1">
									<b>Материал: </b>
								</div>
								<div class="col-md-1">
									<b>Количество: </b>
								</div>
								<div class="col-md-1">
									<b>Цена: </b>
								</div>
								<div class="col-md-1">
									<b>Стоимость: </b>
								</div>
								<div class="col-md-1">
									<b>Оплачено: </b>
								</div>
								<div class="col-md-1">
									<b>Остаток: </b>
								</div>
								<div class="col-md-1">
									<b>Комментарий: </b>
								</div>
								<div class="col-md-2">
									
								</div>	
							</div> <br>
							<form method='POST'>
							<div class="row" id="summary">
								<div class="col-md-1">
									{{ add_item.item }}
								</div>
<!-- 								<div class="col-md-1">
									{{ add_item.size }}
								</div> -->
								<div class="col-md-2">
									{{ add_item.app_method }}
								</div>
								<div class="col-md-1">
									{{ add_item.material }}
								</div>
								<div class="col-md-1">
									{{ add_item.quantity }}
								</div>
								<div class="col-md-1">
									{{add_item.price}}
								</div>
								<div class="col-md-1">
									[[ calculate() ]] руб.
								</div>
								<div class="col-md-1">
									{{add_item.pre_payment}}
								</div>
								<div class="col-md-1">
									[[ calculate_post() ]] руб.
								</div>
								<div class="col-md-1">
									{{ add_item.info }}
								</div>
								<div class="col-md-2 text-right">									
										{% csrf_token %}
										<button type="submit" class="btn btn-info" name="add">
											<i class="fa fa-plus-square"></i> Добавить</button>
								</div>	
							</div>
							</form>
						</div>
						<script type="text/javascript">
							var app = new Vue({
							  delimiters: ['[[', ']]'],
							  el: '#summary',
							  data: { 
							  	quantity: 1,
							  	price: 0,
							  	prepayment: 0,
							  },
							  methods: {
							  	calculate: function() {
							  		return this.quantity * this.price;
							  	},
							  	calculate_post: function() {
							  		return this.quantity * this.price - this.prepayment;
							  	}
							  }
							});
						</script>
						<div class="panel-footer">
							<div class="row text-center">
								<h3>Заказ</h3>
							</div>
						<form method="POST">
							<div class="row">
								<div class="col-md-2">
									Клиент:
								</div>
								<div class="col-md-2">
									<b>{{ client.company }}</b>
								</div>
								<div class="col-md-2">
									Менеджер: 
								</div>
								<div class="col-md-2">
									{{manager.first_name}} {{manager.last_name}}
								</div>
								<div class="col-md-4">
									
								</div>
							</div> <br>
							<div class="row">
								<div class="col-md-12">
									<table class="table table-striped table-bordered">
										<tr>
									<th>
										№
									</th>
									<th>
										Позиция
									</th>
<!-- 									<th>
										Размер
									</th> -->
									<th>
										Метод нанесения
									</th>
									<th>
										Материал
									</th>
									<th>
										Количество
									</th>
									<th>
										Цена
									</th>
									<th>
										Стоимость
									</th>
									<th>
										Предоплата
									</th>
									<th>
										Комментарий
									</th>
									<th>
										
									</th>
									</tr>
										{% for i in cart %}
											<tr>
												<td>{{ forloop.counter }}</td>
												<td>{{ i.item.name }}</td>
												<!-- <td>{{ i.size.size }}</td> -->
												<td>{{ i.app_method.method }} </td>
												<td>{{ i.material.material }}</td>
												<td>{{ i.quantity }}</td>
												<td>{{ i.price }}</td>
												<td>{{ i.total_price }}</td>
												<td>{{ i.pre_payment }}</td>
												<td>{{ i.info }}</td>
												<td align="center" style="padding: 8px;">
															<a href="/manager/orders/position/remove/{{ client.id }}/{{i.id}}"><i class="fa fa-trash-o"></i></a>
												</td>
											</tr>
										{% endfor %}
									</table>
										{% csrf_token %}
										<div class="text-right">
										<button type="submit" class="btn btn-success" name="save">
											<i class="fa fa-check-circle"></i> Отправить в продакшн</button>
										</div>
								</div>
							</div>
						</form>
						</div>
					</div>
					<!-- END OVERVIEW -->
				</div>
			</div>
			<!-- END MAIN CONTENT -->
{% endblock %}